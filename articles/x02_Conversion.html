<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tidyfun">
<title>Converting to &amp; from `tf` • tidyfun</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Converting to &amp; from `tf`">
<meta property="og:description" content="tidyfun">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidyfun</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.98</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidyfun/tidyfun">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/x01_tf_Vectors.html">tf-Vectors and Operations</a>
    <a class="dropdown-item" href="../articles/x02_Conversion.html">Converting data to and from `tf`</a>
    <a class="dropdown-item" href="../articles/x03_Data_Wrangling.html">Data Wrangling</a>
    <a class="dropdown-item" href="../articles/x04_Visualization.html">Visualization</a>
    <a class="dropdown-item" href="../articles/x05_Advice.html">Advice for Developers</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidyfun/tidyfun/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Converting to &amp; from `tf`</h1>
                        <h4 data-toc-skip class="author">Jeff Goldsmith,
Fabian Scheipl</h4>
            
            <h4 data-toc-skip class="date">2024-02-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tidyfun/tidyfun/blob/HEAD/vignettes/x02_Conversion.Rmd" class="external-link"><code>vignettes/x02_Conversion.Rmd</code></a></small>
      <div class="d-none name"><code>x02_Conversion.Rmd</code></div>
    </div>

    
    
<p>Functional data have often been stored in matrices or data frames.
Although these structures have sufficed for some purposes, they are
cumbersome or impossible to use with modern tools for data
wrangling.</p>
<p>In this vignette, we illustrate how to convert data from common
structures to <code>tf</code> objects. Throughout, functional data
vectors are stored as columns in a data frame to facilitate subsequent
wrangling and analysis.</p>
<div class="section level2">
<h2 id="conversion-from-matrices">Conversion from matrices<a class="anchor" aria-label="anchor" href="#conversion-from-matrices"></a>
</h2>
<p>One of the most common structures for storing functional data has
been a matrix. Especially when subjects are observed over the same
(regular or irregular) grid, it is natural to observations on a subject
in rows (or columns) of a matrix. Matrices, however, are difficult to
wrangle along with data in a data frame, leading to confusing and
easy-to-break subsetting across several objects.</p>
<p>In the following examples, we’ll use <code>tfd</code> to get a
<code>tf</code> vector from matrices. The <code>tfd</code> function
expects data to be organized so that each row is the functional
observation for a single subject. It’s possible to focus only on the
resulting <code>tf</code> vector, but in keeping with the broader goals
of <code>tidyfun</code> we’ll add these as columns to a data frame.</p>
<p>The <code>DTI</code> data in the <code>refund</code> package has been
a popular example in functional data analysis. In the code below, we
create a data frame (or <code>tibble</code>) containing scalar
covariates, and then add columns for the <code>cca</code> and
<code>rcst</code> track profiles. This code was used to create the
<code><a href="../reference/dti_df.html">tidyfun::dti_df</a></code> dataset included in the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dti_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu">refund</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/refund/man/DTI.html" class="external-link">DTI</a></span><span class="op">$</span><span class="va">ID</span>,</span>
<span>  visit <span class="op">=</span> <span class="fu">refund</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/refund/man/DTI.html" class="external-link">DTI</a></span><span class="op">$</span><span class="va">visit</span>,</span>
<span>  sex <span class="op">=</span> <span class="fu">refund</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/refund/man/DTI.html" class="external-link">DTI</a></span><span class="op">$</span><span class="va">sex</span>,</span>
<span>  case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu">refund</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/refund/man/DTI.html" class="external-link">DTI</a></span><span class="op">$</span><span class="va">case</span>, <span class="st">"MS"</span>, <span class="st">"control"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dti_df</span><span class="op">$</span><span class="va">cca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyfun.github.io/tf/reference/tfd.html" class="external-link">tfd</a></span><span class="op">(</span><span class="fu">refund</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/refund/man/DTI.html" class="external-link">DTI</a></span><span class="op">$</span><span class="va">cca</span>, arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">93</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dti_df</span><span class="op">$</span><span class="va">rcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyfun.github.io/tf/reference/tfd.html" class="external-link">tfd</a></span><span class="op">(</span><span class="fu">refund</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/refund/man/DTI.html" class="external-link">DTI</a></span><span class="op">$</span><span class="va">rcst</span>, arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">55</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In <code>tfd</code>, the first argument is a matrix; <code>arg</code>
defines the grid over which functions are observed. The output of
<code>tfd</code> is a vector, which we include in the
<code>dti_df</code> data frame.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dti_df</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 382 × 6</span></span></span>
<span><span class="co">##       id visit sex    case                                                  cca</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                                          <span style="color: #949494; font-style: italic;">&lt;tfd_irrg&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">1</span>001     1 female control  [1]: (0.000,0.49);(0.011,0.52);(0.022,0.54); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">1</span>002     1 female control  [2]: (0.000,0.47);(0.011,0.49);(0.022,0.50); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">1</span>003     1 male   control  [3]: (0.000,0.50);(0.011,0.51);(0.022,0.54); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">1</span>004     1 male   control  [4]: (0.000,0.40);(0.011,0.42);(0.022,0.44); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">1</span>005     1 male   control  [5]: (0.000,0.40);(0.011,0.41);(0.022,0.40); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">1</span>006     1 male   control  [6]: (0.000,0.45);(0.011,0.45);(0.022,0.46); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">1</span>007     1 male   control  [7]: (0.000,0.55);(0.011,0.56);(0.022,0.56); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">1</span>008     1 male   control  [8]: (0.000,0.45);(0.011,0.48);(0.022,0.50); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">1</span>009     1 male   control  [9]: (0.000,0.50);(0.011,0.51);(0.022,0.52); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">1</span>010     1 male   control [10]: (0.000,0.46);(0.011,0.47);(0.022,0.48); ...</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 372 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: rcst &lt;tfd_irrg&gt;</span></span></span></code></pre></div>
<p>Finally, we’ll make a quick spaghetti plot to illustrate that the
complete functional data is included in each <code>tf</code> column.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dti_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggspaghetti.html">geom_spaghetti</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">cca</span>, col <span class="op">=</span> <span class="va">case</span>, alpha <span class="op">=</span> <span class="fl">0.2</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="op">(</span><span class="va">case</span> <span class="op">==</span> <span class="st">"control"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html" class="external-link">scale_alpha</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="st">"none"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="x02_Conversion_files/figure-html/unnamed-chunk-3-1.png" width="90%"></p>
<p>We’ll repeat the same basic process using a second, and probably
even-more-perennial, functional data example: the Canadian weather data
in the <code>fda</code> package. Here, functional data are stored in a
three-dimensional array, with dimensions corresponding to day, station,
and outcome (temperature, precipitation, and log10 precipitation).</p>
<p>In the following, we first create a <code>tibble</code> with scalar
covariates, then use <code>tfd</code> to create functional data vectors,
and finally include the resulting vectors in the dataframe. In this
case, our <code>arg</code>s are days of the year, and we use
<code>tf_smooth</code> to smooth the precipitation outcome. Because the
original data matrices record the different observations in the columns
instead of the rows, we have to use their transpose in the call to
<code>tfd</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">canada</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  place <span class="op">=</span> <span class="fu">fda</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/fda/man/CanadianWeather.html" class="external-link">CanadianWeather</a></span><span class="op">$</span><span class="va">place</span>,</span>
<span>  region <span class="op">=</span> <span class="fu">fda</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/fda/man/CanadianWeather.html" class="external-link">CanadianWeather</a></span><span class="op">$</span><span class="va">region</span>,</span>
<span>  lat <span class="op">=</span> <span class="fu">fda</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/fda/man/CanadianWeather.html" class="external-link">CanadianWeather</a></span><span class="op">$</span><span class="va">coordinates</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  lon <span class="op">=</span> <span class="op">-</span><span class="fu">fda</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/fda/man/CanadianWeather.html" class="external-link">CanadianWeather</a></span><span class="op">$</span><span class="va">coordinates</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">fda</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/fda/man/CanadianWeather.html" class="external-link">CanadianWeather</a></span><span class="op">$</span><span class="va">dailyAv</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://tidyfun.github.io/tf/reference/tfd.html" class="external-link">tfd</a></span><span class="op">(</span>arg <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span>,</span>
<span>    precipl10 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">fda</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/fda/man/CanadianWeather.html" class="external-link">CanadianWeather</a></span><span class="op">$</span><span class="va">dailyAv</span><span class="op">[</span>, , <span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://tidyfun.github.io/tf/reference/tfd.html" class="external-link">tfd</a></span><span class="op">(</span>arg <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://tidyfun.github.io/tf/reference/tf_smooth.html" class="external-link">tf_smooth</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## using f = 0.15 as smoother span for lowess</span></span></code></pre></div>
<p>The resulting data frame is shown below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">canada</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 35 × 6</span></span></span>
<span><span class="co">##    place       region     lat   lon                               temp</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;tfd_reg&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> St. Johns   Atlantic  47.3 -<span style="color: #BB0000;">52.4</span>  [1]: (1, -4);(2, -3);(3, -3); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> Halifax     Atlantic  44.4 -<span style="color: #BB0000;">63.4</span>  [2]: (1, -4);(2, -4);(3, -5); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> Sydney      Atlantic  46.1 -<span style="color: #BB0000;">60.1</span>  [3]: (1, -4);(2, -4);(3, -5); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> Yarmouth    Atlantic  43.5 -<span style="color: #BB0000;">66.1</span>  [4]: (1, -1);(2, -2);(3, -2); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> Charlottvl  Atlantic  42.5 -<span style="color: #BB0000;">80.2</span>  [5]: (1, -6);(2, -6);(3, -7); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> Fredericton Atlantic  45.6 -<span style="color: #BB0000;">66.4</span>  [6]: (1, -8);(2, -8);(3, -9); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> Scheffervll Atlantic  54.5 -<span style="color: #BB0000;">64.5</span>  [7]: (1,-22);(2,-23);(3,-23); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> Arvida      Atlantic  48.3 -<span style="color: #BB0000;">71.1</span>  [8]: (1,-14);(2,-14);(3,-15); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> Bagottville Atlantic  48.2 -<span style="color: #BB0000;">70.5</span>  [9]: (1,-15);(2,-15);(3,-16); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> Quebec      Atlantic  46.5 -<span style="color: #BB0000;">71.1</span> [10]: (1,-11);(2,-11);(3,-12); ...</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 25 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: precipl10 &lt;tfd_reg&gt;</span></span></span></code></pre></div>
<p>A plot containing both functional observations is shown below.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_panel</span> <span class="op">&lt;-</span> <span class="va">canada</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">temp</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggspaghetti.html">geom_spaghetti</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">precip_panel</span> <span class="op">&lt;-</span> <span class="va">canada</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">precipl10</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggspaghetti.html">geom_spaghetti</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">temp_panel</span>, <span class="va">precip_panel</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="x02_Conversion_files/figure-html/unnamed-chunk-6-1.png" width="90%"></p>
</div>
<div class="section level2">
<h2 id="conversion-to-tf-from-a-data-frame">Conversion to <code>tf</code> from a data frame<a class="anchor" aria-label="anchor" href="#conversion-to-tf-from-a-data-frame"></a>
</h2>
<div class="section level4">
<h4 id="in-long-format">… in “long” format<a class="anchor" aria-label="anchor" href="#in-long-format"></a>
</h4>
<p>“Long” format data frames containing functional data include columns
containing a subject identifier, the functional argument, and the value
each subject’s function takes at each argument. There are also often
(but not always) non-functional covariates that are repeated within a
subject. For data in this form, we use <code>tf_nest</code> to produce a
data frame containing a single row for each subject.</p>
<p>A first example is the pig weight data from the <code>SemiPar</code>
package, which is a nice example from longitudinal data analysis. This
includes columns for <code>id.num</code>, <code>num.weeks</code>, and
<code>weight</code> – which correspond to the subject, argument, and
value.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pig.weights"</span>, package <span class="op">=</span> <span class="st">"SemiPar"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pig.weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">pig.weights</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pig.weights</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 432 × 3</span></span></span>
<span><span class="co">##    id.num num.weeks weight</span></span>
<span><span class="co">##     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>      1         1   24  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>      1         2   32  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>      1         3   39  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>      1         4   42.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>      1         5   48  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>      1         6   54.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>      1         7   61  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>      1         8   65  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>      1         9   72  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>      2         1   22.5</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 422 more rows</span></span></span></code></pre></div>
<p>We create <code>pig_df</code> by nesting weight within subject. The
result is a data frame containing a single row for each pig, and columns
for <code>id.num</code> and the <code>weight</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pig_df</span> <span class="op">&lt;-</span> <span class="va">pig.weights</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/tf_nest.html">tf_nest</a></span><span class="op">(</span><span class="va">weight</span>, .id <span class="op">=</span> <span class="va">id.num</span>, .arg <span class="op">=</span> <span class="va">num.weeks</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pig_df</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 48 × 2</span></span></span>
<span><span class="co">##    id.num                          weight</span></span>
<span><span class="co">##     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;tfd_reg&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>      1  [1]: (1,24);(2,32);(3,39); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>      2  [2]: (1,22);(2,30);(3,40); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>      3  [3]: (1,22);(2,28);(3,36); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>      4  [4]: (1,24);(2,32);(3,40); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>      5  [5]: (1,24);(2,32);(3,37); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>      6  [6]: (1,23);(2,30);(3,36); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>      7  [7]: (1,22);(2,28);(3,36); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>      8  [8]: (1,24);(2,30);(3,38); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>      9  [9]: (1,20);(2,28);(3,33); ...</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     10 [10]: (1,26);(2,32);(3,40); ...</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 38 more rows</span></span></span></code></pre></div>
<p>We’ll make a quick plot to show the result.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pig_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggspaghetti.html">geom_spaghetti</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="x02_Conversion_files/figure-html/unnamed-chunk-9-1.png" width="90%"></p>
<p>A second example uses the <code>ALA::fev1</code> dataset.
<code>ALA</code> is not available on CRAN but can be installed using the
line below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ALA"</span>, repos <span class="op">=</span> <span class="st">"http://R-Forge.R-project.org"</span><span class="op">)</span></span></code></pre></div>
<p>In this dataset, both <code>height</code> and <code>logFEV1</code>
are observed at multiple ages for each child; that is, there are two
functions observed simultaneously, over a shared argument. We can use
<code>tf_nest</code> to create a dataframe with a single row for each
subject, which includes both non-functional covariates (like age and
height at baseline), and functional observations <code>logFEV1</code>
and <code>height</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ALA</span><span class="fu">::</span><span class="va">fev1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Rows: 1,994</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## $ id      &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, …</span></span>
<span><span class="co">## $ age     &lt;dbl&gt; 9.3415, 10.3929, 11.4524, 12.4600, 13.4182, 15.4743, 16.3723, 6.5873, 7.6496, 12.7392, 13.7741, 14.6940, 15.…</span></span>
<span><span class="co">## $ height  &lt;dbl&gt; 1.20, 1.28, 1.33, 1.42, 1.48, 1.50, 1.52, 1.13, 1.19, 1.49, 1.53, 1.55, 1.56, 1.57, 1.57, 1.18, 1.23, 1.30, …</span></span>
<span><span class="co">## $ age0    &lt;dbl&gt; 9.3415, 9.3415, 9.3415, 9.3415, 9.3415, 9.3415, 9.3415, 6.5873, 6.5873, 6.5873, 6.5873, 6.5873, 6.5873, 6.58…</span></span>
<span><span class="co">## $ height0 &lt;dbl&gt; 1.20, 1.20, 1.20, 1.20, 1.20, 1.20, 1.20, 1.13, 1.13, 1.13, 1.13, 1.13, 1.13, 1.13, 1.13, 1.18, 1.18, 1.18, …</span></span>
<span><span class="co">## $ logFEV1 &lt;dbl&gt; 0.21511, 0.37156, 0.48858, 0.75142, 0.83291, 0.89200, 0.87129, 0.30748, 0.35066, 0.75612, 0.86710, 1.04732, …</span></span>
<span><span class="fu">ALA</span><span class="fu">::</span><span class="va">fev1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_obs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_obs</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/tf_nest.html">tf_nest</a></span><span class="op">(</span><span class="va">logFEV1</span>, <span class="va">height</span>, .arg <span class="op">=</span> <span class="va">age</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Rows: 252</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## $ id      &lt;fct&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 16, 18, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 3…</span></span>
<span><span class="co">## $ age0    &lt;dbl&gt; 9.3415, 6.5873, 6.9131, 6.7598, 6.5024, 6.8994, 6.4339, 7.1869, 6.8966, 7.7892, 7.6140, 7.5483, 7.8412, 6.50…</span></span>
<span><span class="co">## $ height0 &lt;dbl&gt; 1.20, 1.13, 1.18, 1.15, 1.11, 1.24, 1.18, 1.27, 1.17, 1.13, 1.32, 1.25, 1.25, 1.20, 1.19, 1.24, 1.21, 1.23, …</span></span>
<span><span class="co">## $ n_obs   &lt;int&gt; 7, 8, 9, 10, 7, 11, 7, 9, 9, 10, 6, 3, 5, 11, 12, 10, 9, 8, 12, 2, 2, 11, 11, 7, 9, 11, 11, 4, 2, 12, 3, 9, …</span></span>
<span><span class="co">## $ logFEV1 &lt;tfd_irrg&gt; [&lt;9.3415, 10.3929, 11.4524, 12.4600, 13.4182, 15.4743, 16.3723&gt;, &lt;0.21511, 0.37156, 0.48858, 0.75142, 0…</span></span>
<span><span class="co">## $ height  &lt;tfd_irrg&gt; [&lt;9.3415, 10.3929, 11.4524, 12.4600, 13.4182, 15.4743, 16.3723&gt;, &lt;1.20, 1.28, 1.33, 1.42, 1.48, 1.50, 1…</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="in-wide-format">… in “wide” format<a class="anchor" aria-label="anchor" href="#in-wide-format"></a>
</h4>
<p>In some cases functional data are stored in “wide” format, meaning
that there are separate columns for each argument, and values are stored
in these columns. In this case, <code>tf_gather</code> can be use to
collapse across columns to produce a function for each subject.</p>
<p>The example below again uses the <code><a href="https://rdrr.io/pkg/refund/man/DTI.html" class="external-link">refund::DTI</a></code> dataset. We
use <code>tf_gather</code> to transfer the <code>cca</code> observations
from a matrix column (with <code>NA</code>s) into a column of
irregularly observed functions (<code>tfd_irreg</code>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dti_df</span> <span class="op">&lt;-</span> <span class="fu">refund</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/refund/man/DTI.html" class="external-link">DTI</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"rcst"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Rows: 382</span></span>
<span><span class="co">## Columns: 8</span></span>
<span><span class="co">## $ id         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009, 1010,…</span></span>
<span><span class="co">## $ visit      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span><span class="co">## $ visit_time <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ nscans     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span><span class="co">## $ case       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ sex        <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> female, female, male, male, male, male, male, male, male, m…</span></span>
<span><span class="co">## $ pasat      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…</span></span>
<span><span class="co">## $ cca        <span style="color: #949494; font-style: italic;">&lt;dbl[,93]&gt;</span> &lt;matrix[26 x 93]&gt;</span></span>
<span></span>
<span><span class="va">dti_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/tf_gather.html">tf_gather</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"cca"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## creating new tfd-column &lt;cca&gt;</span></span>
<span><span class="co">## Rows: 382</span></span>
<span><span class="co">## Columns: 8</span></span>
<span><span class="co">## $ id         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009, 1010,…</span></span>
<span><span class="co">## $ visit      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span><span class="co">## $ visit_time <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ nscans     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span><span class="co">## $ case       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ sex        <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> female, female, male, male, male, male, male, male, male, m…</span></span>
<span><span class="co">## $ pasat      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…</span></span>
<span><span class="co">## $ cca        <span style="color: #949494; font-style: italic;">&lt;tfd_irrg&gt;</span> [&lt;1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="other-formats">Other formats<a class="anchor" aria-label="anchor" href="#other-formats"></a>
</h2>
<p><code>fda</code> and <code>fd</code> coming soon …</p>
</div>
<div class="section level2">
<h2 id="reversing-the-conversion">Reversing the conversion<a class="anchor" aria-label="anchor" href="#reversing-the-conversion"></a>
</h2>
<p><strong><code>tidyfun</code></strong> includes a wide range of tools
for exploratory analysis and visualization, but many analysis approaches
require data to be stored in more traditional formats. Several functions
are available to aid in this conversion.</p>
<div class="section level3">
<h3 id="conversion-from-tf-to-data-frames">Conversion from <code>tf</code> to data frames<a class="anchor" aria-label="anchor" href="#conversion-from-tf-to-data-frames"></a>
</h3>
<p>The functions <code>tf_unnest</code> and <code>tf_spread</code>
reverse the operations in <code>tf_nest</code> and
<code>tf_gather</code>, respectively – that is, they take a data frame
with a functional observation and produce long or wide data frames.
We’ll illustrate these with the <code>pig_df</code> data set.</p>
<p>First, to produce a long-format data frame, one can use
<code>tf_unnest</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pig_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/tf_unnest.html">tf_unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">weight</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Rows: 432</span></span>
<span><span class="co">## Columns: 3</span></span>
<span><span class="co">## $ id.num       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, …</span></span>
<span><span class="co">## $ weight_arg   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 1, 2, 3, 4, 5, 6, 7, 8, 9, 1, …</span></span>
<span><span class="co">## $ weight_value <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 24.0, 32.0, 39.0, 42.5, 48.0, 54.5, 61.0, 65.0, 72.0, 22.…</span></span></code></pre></div>
<p>To produce a wide-format data frame, one can use
<code>tf_spread</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pig_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/tf_spread.html">tf_spread</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Rows: 48</span></span>
<span><span class="co">## Columns: 10</span></span>
<span><span class="co">## $ id.num   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18…</span></span>
<span><span class="co">## $ weight_1 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 24.0, 22.5, 22.5, 24.0, 24.5, 23.0, 22.5, 23.5, 20.0, 25.5, 2…</span></span>
<span><span class="co">## $ weight_2 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 32.0, 30.5, 28.0, 31.5, 31.5, 30.0, 28.5, 30.5, 27.5, 32.5, 3…</span></span>
<span><span class="co">## $ weight_3 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 39.0, 40.5, 36.5, 39.5, 37.0, 35.5, 36.0, 38.0, 33.0, 39.5, 4…</span></span>
<span><span class="co">## $ weight_4 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 42.5, 45.0, 41.0, 44.5, 42.5, 41.0, 43.5, 41.0, 39.0, 47.0, 4…</span></span>
<span><span class="co">## $ weight_5 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 48.0, 51.0, 47.5, 51.0, 48.0, 48.0, 47.0, 48.5, 43.5, 53.0, 5…</span></span>
<span><span class="co">## $ weight_6 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 54.5, 58.5, 55.0, 56.0, 54.0, 51.5, 53.5, 55.0, 49.0, 58.5, 5…</span></span>
<span><span class="co">## $ weight_7 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 61.0, 64.0, 61.0, 59.5, 58.0, 56.5, 59.5, 59.5, 54.5, 63.0, 6…</span></span>
<span><span class="co">## $ weight_8 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 65.0, 72.0, 68.0, 64.0, 63.0, 63.5, 67.5, 66.5, 59.5, 69.5, 6…</span></span>
<span><span class="co">## $ weight_9 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 72.0, 78.0, 76.0, 67.0, 65.5, 69.5, 73.5, 73.0, 65.0, 76.0, 7…</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="converting-back-to-a-matrix-or-data-frame">Converting back to a matrix or data frame<a class="anchor" aria-label="anchor" href="#converting-back-to-a-matrix-or-data-frame"></a>
</h3>
<p>To convert <code>tf</code> vector to a matrix with each row
containing the function evaluations for one function, use
<code>as.matrix</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_vec</span> <span class="op">&lt;-</span> <span class="va">pig_df</span><span class="op">$</span><span class="va">weight</span></span>
<span></span>
<span><span class="va">weight_matrix</span> <span class="op">&lt;-</span> <span class="va">weight_vec</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">weight_matrix</span><span class="op">)</span></span>
<span><span class="co">##      1    2    3    4    5    6    7    8    9</span></span>
<span><span class="co">## 1 24.0 32.0 39.0 42.5 48.0 54.5 61.0 65.0 72.0</span></span>
<span><span class="co">## 2 22.5 30.5 40.5 45.0 51.0 58.5 64.0 72.0 78.0</span></span>
<span><span class="co">## 3 22.5 28.0 36.5 41.0 47.5 55.0 61.0 68.0 76.0</span></span>
<span><span class="co">## 4 24.0 31.5 39.5 44.5 51.0 56.0 59.5 64.0 67.0</span></span>
<span><span class="co">## 5 24.5 31.5 37.0 42.5 48.0 54.0 58.0 63.0 65.5</span></span>
<span><span class="co">## 6 23.0 30.0 35.5 41.0 48.0 51.5 56.5 63.5 69.5</span></span>
<span></span>
<span><span class="co"># argument values of input data saved in `arg`-attribute:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">weight_matrix</span>, <span class="st">"arg"</span><span class="op">)</span></span>
<span><span class="co">## [1] 1 2 3 4 5 6 7 8 9</span></span></code></pre></div>
<p>To convert a <code>tf</code> vector to a standalone data frame with
<code>"id"</code>,<code>"arg"</code>,<code>"value"</code>-columns, use
<code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> with <code>unnest = TRUE</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_vec</span></span>
<span><span class="co">## tfd[48] on (1,9) based on 9 evaluations each</span></span>
<span><span class="co">## interpolation by tf_approx_linear </span></span>
<span><span class="co">## 1: (1,24);(2,32);(3,39); ...</span></span>
<span><span class="co">## 2: (1,22);(2,30);(3,40); ...</span></span>
<span><span class="co">## 3: (1,22);(2,28);(3,36); ...</span></span>
<span><span class="co">## 4: (1,24);(2,32);(3,40); ...</span></span>
<span><span class="co">## 5: (1,24);(2,32);(3,37); ...</span></span>
<span><span class="co">##     [....]   (43 not shown)</span></span>
<span></span>
<span><span class="va">weight_vec</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>unnest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##     id arg value</span></span>
<span><span class="co">## 1.1  1   1  24.0</span></span>
<span><span class="co">## 1.2  1   2  32.0</span></span>
<span><span class="co">## 1.3  1   3  39.0</span></span>
<span><span class="co">## 1.4  1   4  42.5</span></span>
<span><span class="co">## 1.5  1   5  48.0</span></span>
<span><span class="co">## 1.6  1   6  54.5</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Fabian Scheipl, Jeff Goldsmith, Julia Wrobel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
